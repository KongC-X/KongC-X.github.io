<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AJAX | 萌萌哒的瑞萌萌</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/V.png">
    <meta name="description" content="">
    <link rel="preload" href="/assets/css/0.styles.30c7bf29.css" as="style"><link rel="preload" href="/assets/js/app.9189764f.js" as="script"><link rel="preload" href="/assets/js/2.ef243b8b.js" as="script"><link rel="preload" href="/assets/js/5.0210a7e9.js" as="script"><link rel="prefetch" href="/assets/js/10.903576aa.js"><link rel="prefetch" href="/assets/js/11.6ee9811e.js"><link rel="prefetch" href="/assets/js/12.937ec838.js"><link rel="prefetch" href="/assets/js/13.7f5f13fd.js"><link rel="prefetch" href="/assets/js/14.a542474a.js"><link rel="prefetch" href="/assets/js/15.14a7d97c.js"><link rel="prefetch" href="/assets/js/16.3b94da96.js"><link rel="prefetch" href="/assets/js/3.c528d442.js"><link rel="prefetch" href="/assets/js/4.7bd9e854.js"><link rel="prefetch" href="/assets/js/6.b1764dcb.js"><link rel="prefetch" href="/assets/js/7.ed543e95.js"><link rel="prefetch" href="/assets/js/8.feefd08d.js"><link rel="prefetch" href="/assets/js/9.17255510.js">
    <link rel="stylesheet" href="/assets/css/0.styles.30c7bf29.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/V.png" alt="萌萌哒的瑞萌萌" class="logo"> <span class="site-name can-hide">萌萌哒的瑞萌萌</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><span class="title">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/HTML/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/Sass/" class="nav-link">
  Sass
</a></li><li class="dropdown-item"><!----> <a href="/Less/" class="nav-link">
  Less
</a></li><li class="dropdown-item"><!----> <a href="/Bootstrap4/" class="nav-link">
  Bootstrap4
</a></li><li class="dropdown-item"><!----> <a href="/JSON/" class="nav-link">
  JSON
</a></li><li class="dropdown-item"><!----> <a href="/AJAX/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  AJAX
</a></li><li class="dropdown-item"><!----> <a href="/Linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/HTTP/" class="nav-link">
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/Webpack/" class="nav-link">
  Webpack
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/KongC-X" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><span class="title">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/HTML/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/CSS/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/Sass/" class="nav-link">
  Sass
</a></li><li class="dropdown-item"><!----> <a href="/Less/" class="nav-link">
  Less
</a></li><li class="dropdown-item"><!----> <a href="/Bootstrap4/" class="nav-link">
  Bootstrap4
</a></li><li class="dropdown-item"><!----> <a href="/JSON/" class="nav-link">
  JSON
</a></li><li class="dropdown-item"><!----> <a href="/AJAX/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  AJAX
</a></li><li class="dropdown-item"><!----> <a href="/Linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/Vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/HTTP/" class="nav-link">
  HTTP
</a></li><li class="dropdown-item"><!----> <a href="/Webpack/" class="nav-link">
  Webpack
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/KongC-X" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/AJAX/" aria-current="page" class="active sidebar-link">AJAX</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/AJAX/#什么是-ajax-？" class="sidebar-link">什么是 AJAX ？</a></li><li class="sidebar-sub-header"><a href="/AJAX/#xmlhttprequest-对象" class="sidebar-link">XMLHttpRequest 对象</a></li><li class="sidebar-sub-header"><a href="/AJAX/#向服务器发送请求" class="sidebar-link">向服务器发送请求</a></li><li class="sidebar-sub-header"><a href="/AJAX/#服务器响应" class="sidebar-link">服务器响应</a></li><li class="sidebar-sub-header"><a href="/AJAX/#onreadystatechange-事件" class="sidebar-link">onreadystatechange 事件</a></li><li class="sidebar-sub-header"><a href="/AJAX/#ajax-的优缺点" class="sidebar-link">AJAX 的优缺点</a></li><li class="sidebar-sub-header"><a href="/AJAX/#补充（代码详解）" class="sidebar-link">补充（代码详解）</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ajax"><a href="#ajax" class="header-anchor">#</a> AJAX</h1> <h2 id="什么是-ajax-？"><a href="#什么是-ajax-？" class="header-anchor">#</a> 什么是 AJAX ？</h2> <p>AJAX = Asynchronous JavaScript and XML（异步的 JavaScript 和 XML）。</p> <p>AJAX 是一种用于创建快速动态网页的技术。</p> <p>通过在后台与服务器进行少量数据交换，AJAX 可以使网页实现异步更新。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。</p> <p>传统的网页（不使用 AJAX）如果需要更新内容，必需重载整个网页面。</p> <p>有很多使用 AJAX 的应用程序案例：新浪微博、Google 地图、开心网等等。</p> <h2 id="xmlhttprequest-对象"><a href="#xmlhttprequest-对象" class="header-anchor">#</a> XMLHttpRequest 对象</h2> <p><strong>XMLHttpRequest 是 AJAX 的基础。</strong></p> <p>所有现代浏览器均支持 XMLHttpRequest 对象（IE5 和 IE6 使用 ActiveXObject）。</p> <p>XMLHttpRequest 用于在后台与服务器交换数据。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。</p> <h3 id="创建-xmlhttprequest-对象"><a href="#创建-xmlhttprequest-对象" class="header-anchor">#</a> 创建 XMLHttpRequest 对象</h3> <p>所有现代浏览器（IE7+、Firefox、Chrome、Safari 以及 Opera）均内建 XMLHttpRequest 对象。</p> <h4 id="创建-xmlhttprequest-对象的语法："><a href="#创建-xmlhttprequest-对象的语法：" class="header-anchor">#</a> 创建 XMLHttpRequest 对象的语法：</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>variable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="老版本的-internet-explorer-（ie5-和-ie6）使用-activex-对象："><a href="#老版本的-internet-explorer-（ie5-和-ie6）使用-activex-对象：" class="header-anchor">#</a> 老版本的 Internet Explorer （IE5 和 IE6）使用 ActiveX 对象：</h4> <div class="language-js extra-class"><pre class="language-js"><code>variable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span><span class="token string">&quot;Microsoft.XMLHTTP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>为了应对所有的现代浏览器，包括 IE5 和 IE6，请检查浏览器是否支持 XMLHttpRequest 对象。如果支持，则创建 XMLHttpRequest 对象。如果不支持，则创建 ActiveXObject ：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> xmlhttp<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>XMLHttpRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span>
  xmlhttp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// code for IE6, IE5</span>
  xmlhttp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span><span class="token string">&quot;Microsoft.XMLHTTP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="向服务器发送请求"><a href="#向服务器发送请求" class="header-anchor">#</a> 向服务器发送请求</h2> <p>XMLHttpRequest 对象用于和服务器交换数据。</p> <p>如需将请求发送到服务器，我们使用 XMLHttpRequest 对象的 open() 和 send() 方法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>xmlhttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test1.txt&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xmlhttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><table><thead><tr><th style="text-align:left;">方法</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">open(<em>method</em>,<em>url</em>,<em>async</em>)</td> <td style="text-align:left;">规定请求的类型、URL 以及是否异步处理请求。<em>method</em>：请求的类型；GET 或 POST<em>url</em>：文件在服务器上的位置<em>async</em>：true（异步）或 false（同步）</td></tr> <tr><td style="text-align:left;">send(<em>string</em>)</td> <td style="text-align:left;">将请求发送到服务器。<em>string</em>：仅用于 POST 请求</td></tr></tbody></table> <h3 id="get-还是-post？"><a href="#get-还是-post？" class="header-anchor">#</a> GET 还是 POST？</h3> <p>与 POST 相比，GET 更简单也更快，并且在大部分情况下都能用。</p> <p>然而，在以下情况中，请使用 POST 请求：</p> <ul><li>无法使用缓存文件（更新服务器上的文件或数据库）</li> <li>向服务器发送大量数据（POST 没有数据量限制）</li> <li>发送包含未知字符的用户输入时，POST 比 GET 更稳定也更可靠</li></ul> <p>如果需要像 HTML 表单那样 POST 数据，请使用 setRequestHeader() 来添加 HTTP 头。然后在 send() 方法中规定您希望发送的数据：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>xmlhttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ajax_test.asp&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xmlhttp<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/x-www-form-urlencoded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xmlhttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;fname=Bill&amp;lname=Gates&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><table><thead><tr><th style="text-align:left;">方法</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">setRequestHeader(<em>header</em>,<em>value</em>)</td> <td style="text-align:left;">向请求添加 HTTP 头。</td></tr></tbody></table> <ul><li><em>header</em>: 规定头的名称</li> <li><em>value</em>: 规定头的值</li></ul> <h3 id="url-服务器上的文件"><a href="#url-服务器上的文件" class="header-anchor">#</a> url - 服务器上的文件</h3> <p>open() 方法的 <em>url</em> 参数是服务器上文件的地址：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>xmlhttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ajax_test.asp&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>该文件可以是任何类型的文件，比如 .txt 和 .xml，或者服务器脚本文件，比如 .asp 和 .php （在传回响应之前，能够在服务器上执行任务）。</p> <h3 id="异步-true-或-false？"><a href="#异步-true-或-false？" class="header-anchor">#</a> 异步 - True 或 False？</h3> <p>AJAX 指的是异步 JavaScript 和 XML（Asynchronous JavaScript and XML）。</p> <p>XMLHttpRequest 对象如果要用于 AJAX 的话，其 open() 方法的 async 参数必须设置为 true：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>xmlhttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ajax_test.asp&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>对于 web 开发人员来说，发送异步请求是一个巨大的进步。很多在服务器执行的任务都相当费时。AJAX 出现之前，这可能会引起应用程序挂起或停止。</p> <p>通过 AJAX，JavaScript 无需等待服务器的响应，而是：</p> <ul><li>在等待服务器响应时执行其他脚本</li> <li>当响应就绪后对响应进行处理</li></ul> <h3 id="async-true"><a href="#async-true" class="header-anchor">#</a> Async = true</h3> <p>当使用 async=true 时，请规定在响应处于 onreadystatechange 事件中的就绪状态时执行的函数：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>xmlhttp<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xmlhttp<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> xmlhttp<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;myDiv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> xmlhttp<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
xmlhttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test1.txt&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xmlhttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="async-false"><a href="#async-false" class="header-anchor">#</a> Async = false</h3> <p>如需使用 async=false，请将 open() 方法中的第三个参数改为 false：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>xmlhttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test1.txt&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>我们不推荐使用 async=false，但是对于一些小型的请求，也是可以的。</p> <p>请记住，JavaScript 会等到服务器响应就绪才继续执行。如果服务器繁忙或缓慢，应用程序会挂起或停止。</p> <p>**注释：**当您使用 async=false 时，请不要编写 onreadystatechange 函数 - 把代码放到 send() 语句后面即可：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>xmlhttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test1.txt&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xmlhttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;myDiv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> xmlhttp<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
</code></pre></div><h2 id="服务器响应"><a href="#服务器响应" class="header-anchor">#</a> 服务器响应</h2> <p>如需获得来自服务器的响应，请使用 XMLHttpRequest 对象的 responseText 或 responseXML 属性。</p> <table><thead><tr><th style="text-align:left;">属性</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">responseText</td> <td style="text-align:left;">获得字符串形式的响应数据。</td></tr> <tr><td style="text-align:left;">responseXML</td> <td style="text-align:left;">获得 XML 形式的响应数据。</td></tr></tbody></table> <h3 id="responsetext-属性"><a href="#responsetext-属性" class="header-anchor">#</a> responseText 属性</h3> <p>如果来自服务器的响应并非 XML，请使用 responseText 属性。</p> <p>responseText 属性返回字符串形式的响应，因此您可以这样使用：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;myDiv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> xmlhttp<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
</code></pre></div><h3 id="responsexml-属性"><a href="#responsexml-属性" class="header-anchor">#</a> responseXML 属性</h3> <p>如果来自服务器的响应是 XML，而且需要作为 XML 对象进行解析，请使用 responseXML 属性：</p> <p>请求 <a href="https://www.w3school.com.cn/example/xmle/books.xml" target="_blank" rel="noopener noreferrer">books.xml<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 文件，并解析响应：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>xmlDoc <span class="token operator">=</span> xmlhttp<span class="token punctuation">.</span>responseXML<span class="token punctuation">;</span>
txt <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
x <span class="token operator">=</span> xmlDoc<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">&quot;ARTIST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> x<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  txt <span class="token operator">=</span> txt <span class="token operator">+</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nodeValue <span class="token operator">+</span> <span class="token string">&quot;&lt;br /&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;myDiv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> txt<span class="token punctuation">;</span>
</code></pre></div><h2 id="onreadystatechange-事件"><a href="#onreadystatechange-事件" class="header-anchor">#</a> onreadystatechange 事件</h2> <p>当请求被发送到服务器时，我们需要执行一些基于响应的任务。</p> <p>每当 readyState 改变时，就会触发 onreadystatechange 事件。</p> <p>readyState 属性存有 XMLHttpRequest 的状态信息。</p> <p>下面是 XMLHttpRequest 对象的三个重要的属性：</p> <table><thead><tr><th style="text-align:left;">属性</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">onreadystatechange</td> <td style="text-align:left;">存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数。</td></tr> <tr><td style="text-align:left;">readyState</td> <td style="text-align:left;">存有 XMLHttpRequest 的状态。从 0 到 4 发生变化。0: 请求未初始化 1: 服务器连接已建立 2: 请求已接收 3: 请求处理中 4: 请求已完成，且响应已就绪</td></tr> <tr><td style="text-align:left;">status</td> <td style="text-align:left;">200: &quot;OK&quot;404: 未找到页面</td></tr></tbody></table> <p>在 onreadystatechange 事件中，我们规定当服务器响应已做好被处理的准备时所执行的任务。</p> <p>当 readyState 等于 4 且状态为 200 时，表示响应已就绪：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>xmlhttp<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xmlhttp<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> xmlhttp<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;myDiv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> xmlhttp<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>**注释：**onreadystatechange 事件被触发 5 次（0 - 4），对应着 readyState 的每个变化。</p> <h3 id="使用-callback-函数"><a href="#使用-callback-函数" class="header-anchor">#</a> 使用 Callback 函数</h3> <p>callback 函数是一种以参数形式传递给另一个函数的函数。</p> <p>如果您的网站上存在多个 AJAX 任务，那么您应该为创建 XMLHttpRequest 对象编写一个<em>标准</em>的函数，并为每个 AJAX 任务调用该函数。</p> <p>该函数调用应该包含 URL 以及发生 onreadystatechange 事件时执行的任务（每次调用可能不尽相同）：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">myFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">loadXMLDoc</span><span class="token punctuation">(</span><span class="token string">&quot;ajax_info.txt&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xmlhttp<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> xmlhttp<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;myDiv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> xmlhttp<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="ajax-的优缺点"><a href="#ajax-的优缺点" class="header-anchor">#</a> AJAX 的优缺点</h2> <p>优点：</p> <ol><li>AJAX 使用 Javascript 技术向服务器发送异步请求；</li> <li>AJAX 无须刷新整个页面；</li> <li>因为服务器响应内容不再是整个页面，而是页面中的局部，所以 AJAX 性能高；</li></ol> <p>缺点：</p> <ol><li>AJAX 并不适合所有场景，很多时候还是要使用同步交互；</li> <li>AJAX 虽然提高了用户体验，但无形中向服务器发送的请求次数增多了，导致服务器压力增大；</li> <li>因为 AJAX 是在浏览器中使用 Javascript 技术完成的，所以还需要处理浏览器兼容性问题；</li></ol> <h2 id="补充（代码详解）"><a href="#补充（代码详解）" class="header-anchor">#</a> 补充（代码详解）</h2> <h3 id="xmlhttprequest"><a href="#xmlhttprequest" class="header-anchor">#</a> XMLHttpRequest</h3> <p><strong>前端的 register.html 文件</strong></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>msg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>aaa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  用户名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span> 昵称：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
    <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>nickname<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">/&gt;</span></span>
  密码： <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>注册<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 显示ajax请求返回回来的数据 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>showmsg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>前端基于 http 发送的一个异步请求</strong></p> <p><strong>前端的 get 请求(重要)</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onblur</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// 1.获取用户数据</span>
            <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>

            <span class="token comment">// 2，让异步对象发送请求</span>
            <span class="token comment">// 2.1 创建异步对象</span>
            <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 2.2 设置 请求行 open(请求方式，请求url):</span>
                <span class="token comment">// get请求如果有参数就需要在url后面拼接参数，</span>
            xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;validate.php?username=&quot;</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 2.3 设置 请求头 setRequestHeader('key':'value')</span>
                <span class="token comment">// get方式不需要设置请求头</span>
            <span class="token comment">// 2.4 设置 请求体:发送请求  send(参数：key=value&amp;key=value)</span>
                <span class="token comment">// 对于 get请求不需要在这个位置来传递参数</span>
            xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 响应报文：</span>
            <span class="token comment">// 报文行：响应状态码 响应状态信息  200 ok</span>
            <span class="token comment">// 报文头：服务器返回给客户端的一些额外信息</span>
            <span class="token comment">// 报文体：服务器返回给客户端的数据 responseText:普通字符串  responseXML：符合xml格式的字符串</span>
            <span class="token comment">// xhr.status:可以获取当前服务器的响应状态  200 》成功</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 一个真正成功的响应应该两个方面：1.服务器成功响应  2.数据已经回到客户端并且可以使用了</span>
            <span class="token comment">// 监听异步对象的响应状态 readystate</span>
            <span class="token comment">// 0:创建了异步对象，但是还没有真正的去发送请求</span>
            <span class="token comment">// 1.调用了send方法，正在发送请求</span>
            <span class="token comment">// 2.send方法执行完毕了，已经收到服务器的响应内容--原始内容，还不可以使用</span>
            <span class="token comment">// 3.正在解析数据</span>
            <span class="token comment">// 4.响应内容解析完毕，可以使用了</span>
            xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//等待浏览器返回成功并且解析完毕</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;-----------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.showmsg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p><strong>前端的 post 请求(重要)</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onblur</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// 1.获取用户数据</span>
            <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            <span class="token comment">// 2. 让异步对象发送post请求</span>
            <span class="token comment">// 2.1 创建异步对象</span>
            <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 2.2 设置请求行 open(请求方式，请求url)</span>
                <span class="token comment">// 2.post请求不需要拼接参数</span>
            xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;validate.php&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 2.3 设置请求头:setRequestHeader()</span>
                <span class="token comment">// 2.post需要设置请求头：Content-Type:application/x-www-form-urlencoded</span>
            xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;application/x-www-form-urlencoded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    		<span class="token comment">//.如果没有设置，参数无法正确的传递到服务器(本质上说，如果没有参数，也不一定需要设置，不会影响请求的发送)</span>
            <span class="token comment">// 2.4 设置请求体 send()</span>
                <span class="token comment">// 2.post的参数在这个函数中设置(如果有参数)</span>
            xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;username=&quot;</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 3.让异步对象接收服务器的响应数据</span>
            <span class="token comment">// 一个成功的响应有两个条件：1.服务器成功响应了  2.异步对象的响应状态为4(数据解析完毕可以使用了)</span>
            <span class="token comment">// 当异步对象的响应状态发生改变的时候，会触发一个事件：onreadystatechange</span>
            xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// 判断服务器是否响应      判断异步对象的响应状态</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.showmsg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p><strong>处理后端的 php 文件</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'content-type:text/html;charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'REQUEST_METHOD'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token single-quoted-string string">'POST'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//获取用户名</span>
        <span class="token variable">$name</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//判断数据库中是否已有这个用户名</span>
        <span class="token variable">$names</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'jack'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'rose'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'tom'</span><span class="token punctuation">,</span><span class="token single-quoted-string string">'lili'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//有则注册失败，否则成功</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$names</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'这个名字太火了，换一个吧！'</span><span class="token punctuation">;</span>
            <span class="token keyword">echo</span> <span class="token variable">$str</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'恭喜，名字可用！'</span><span class="token punctuation">;</span>
            <span class="token keyword">echo</span> <span class="token variable">$str</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token delimiter important">?&gt;</span></span>
</code></pre></div><p><strong>API 详解</strong></p> <p>xhr.open() 发起请求，可以是 get、post 方式</p> <p>xhr.setRequestHeader() 设置请求头</p> <p>xhr.send() 发送请求主体 get 方式使用 xhr.send(null)</p> <p>xhr.onreadystatechange = function () {} 监听响应状态</p> <p>readstate 属性有五个状态：</p> <ul><li>xhr.readyState = 0 时，（未初始化）还没有调用 send()方法</li> <li>xhr.readyState = 1 时，（载入）已调用 send()方法，正在发送请求</li> <li>xhr.readyState = 2 时，（载入完成）send()方法执行完成，已经接收到全部响应内容</li> <li>xhr.readyState = 3 时，（交互）正在解析响应内容</li> <li>xhr.readyState = 4 时，（完成）响应内容解析完成，可以在客户端调用了</li></ul> <div class="language- extra-class"><pre class="language-text"><code>不用记忆状态，只需要了解有状态变化这个概念
</code></pre></div><p>xhr.status 表示响应码，如 200</p> <p>xhr.statusText 表示响应信息，如 OK</p> <p>xhr.getAllResponseHeaders() 获取全部响应头信息</p> <p>xhr.getResponseHeader(‘key’) 获取指定头信息</p> <p>xhr.responseText、xhr.responseXML 都表示响应主体</p> <p><strong>注 GET 和 POST 请求方式的差异（面试题）</strong></p> <p>1、GET 没有请求主体，使用 xhr.send(null)</p> <p>2、GET 可以通过在请求 URL 上添加请求参数</p> <p>3、POST 可以通过 xhr.send(‘name=itcast&amp;age=10’)</p> <p>4、POST 需要设置</p> <p>5、GET 大小限制约 4K，POST 则没有限制</p> <h3 id="使用异步对象发送读取-json-文件"><a href="#使用异步对象发送读取-json-文件" class="header-anchor">#</a> 使用异步对象发送读取 JSON 文件</h3> <h4 id="json-格式的数据和特点"><a href="#json-格式的数据和特点" class="header-anchor">#</a> JSON 格式的数据和特点</h4> <p>描述数据的一种格式</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./images/nav_1.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;京东超市&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./images/nav_2.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;全球购物&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./images/nav_3.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;京东市场&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h4 id="规则和特点"><a href="#规则和特点" class="header-anchor">#</a> 规则和特点</h4> <table><thead><tr><th>关于 json 的描述</th></tr></thead> <tbody><tr><td>1，一组花括号表示一个对象，一个对象通过键值对写入一堆相关数据</td></tr> <tr><td>2，一组方括号表示一个数组，多组对象通过数组的方式装载</td></tr> <tr><td>3，对象的所有属性都必须加上双引号，值没有 undefined</td></tr> <tr><td>4，文件后缀名为.json，json 格式的数据内不允许写注释</td></tr></tbody></table> <h4 id="操作-json-的方法"><a href="#操作-json-的方法" class="header-anchor">#</a> 操作 json 的方法</h4> <table><thead><tr><th>前端(Javascript)操作 json 的方式</th> <th></th></tr></thead> <tbody><tr><td>JSON.parse(json 字符串)</td> <td>将 json 格式的字符串转换为数组或者对象</td></tr> <tr><td>JSON.stringify(对象或者数组)</td> <td>将字面量对象或者数组转换为 json 格式的字符串</td></tr> <tr><td>php 操作 json 的方式</td> <td></td></tr> <tr><td>json_decode(json 字符串)</td> <td>将 json 格式的字符串转换为 php 的数组或者对象</td></tr> <tr><td>json_encode(关联数组)</td> <td>将 php 的数组转换为 json 字符串</td></tr></tbody></table> <h4 id="关于-json-的操作"><a href="#关于-json-的操作" class="header-anchor">#</a> 关于 json 的操作</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        <span class="token comment">// 让异步对象发送异步请求</span>
        <span class="token comment">// 1.创建对象</span>
        <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2.设置请求行</span>
        xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;./server/nav-json.php&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3.设置请求头:get不需要设置</span>
        <span class="token comment">// 3.设置请求体</span>
        xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 让异步对象接收服务器响应数据:一个成功的响应包含两个条件：1.服务器成功响应了  2.数据解析完毕可以使用了</span>
        xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> result <span class="token operator">=</span> xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
                <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    html <span class="token operator">+=</span> <span class="token string">&quot;&lt;li&gt;&quot;</span><span class="token punctuation">;</span>
                    html <span class="token operator">+=</span> <span class="token string">'&lt;a href=&quot;#&quot;&gt;'</span><span class="token punctuation">;</span>
                    html <span class="token operator">+=</span> <span class="token string">'&lt;img src=&quot;'</span> <span class="token operator">+</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>src <span class="token operator">+</span> <span class="token string">'&quot; alt=&quot;&quot;&gt;'</span><span class="token punctuation">;</span>
                    html <span class="token operator">+=</span> <span class="token string">'&lt;p&gt;'</span> <span class="token operator">+</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>text <span class="token operator">+</span> <span class="token string">'&lt;/p&gt;'</span><span class="token punctuation">;</span>
                    html <span class="token operator">+=</span> <span class="token string">'&lt;/a&gt;'</span><span class="token punctuation">;</span>
                    html <span class="token operator">+=</span> <span class="token string">'&lt;/li&gt;'</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// 将生成的页面结构添加到dom元素中</span>
                document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;ul&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> html<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>后端处理 php 文件的代码</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;../data/nav.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span>
</code></pre></div><h3 id="封装-ajax-工具函数"><a href="#封装-ajax-工具函数" class="header-anchor">#</a> 封装 AJAX 工具函数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// type:请求方式</span>
<span class="token comment">// url:请求url</span>
<span class="token comment">// data:传递给服务器的参数</span>
<span class="token comment">// callback:客户端的动态结构的渲染方式</span>

<span class="token comment">// 下面的封装方式的缺点：</span>
<span class="token comment">// 1.参数数量固定：用户在调用的时候必须传入四个参数</span>
<span class="token comment">// 2.参数的顺序固定：用户在调用的时候必须按照顺序进行参数的传递</span>
<span class="token comment">// 3.不方便后期封装功能的扩展与修改</span>
<span class="token comment">// function ajax(type,url,data,callback){}</span>

<span class="token comment">// 解决方式：通过传入对象的方式来设置参数</span>
<span class="token comment">// option是一个对象，它里面包含着相关的属性：如type,url,data,callback</span>
<span class="token comment">// 不方便后期功能的添加与扩展</span>
<span class="token comment">// 会造成当前文件中存在着大量的全局变量，会造成全局变量污染</span>
<span class="token comment">// function ajax(option){}</span>
<span class="token comment">// function get(option){}</span>
<span class="token comment">// function post(option){}</span>
<span class="token comment">// 建议的封装方式：</span>
<span class="token keyword">var</span> $ <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 将{&quot;name&quot;:&quot;jack&quot;,&quot;age&quot;:20} 的参数要转换为 ?name=jack&amp;age=20</span>
  <span class="token function-variable function">getpa</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> data <span class="token operator">==</span> <span class="token string">&quot;object&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">&quot;?&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        str <span class="token operator">=</span> str <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;&amp;&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> str<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> str<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// option.type:请求方式</span>
  <span class="token comment">// option.url:请求的url</span>
  <span class="token comment">// option.data:当前请求所传递的参数:规定参数必须是以对象的形式传递{&quot;name&quot;:&quot;jack&quot;,&quot;age&quot;:20}</span>
  <span class="token comment">// option.success:渲染方式</span>
  <span class="token function-variable function">ajax</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 接收用户参数进行相应处理</span>
    <span class="token keyword">var</span> type <span class="token operator">=</span> option<span class="token punctuation">.</span>type <span class="token operator">||</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// location.href 可以获取当前文件的路径</span>
    <span class="token keyword">var</span> url <span class="token operator">=</span> option<span class="token punctuation">.</span>url <span class="token operator">||</span> location<span class="token punctuation">.</span>href<span class="token punctuation">;</span>
    <span class="token comment">// 接收参数:在js中最方便收集的数据类型为对象，所以我们就规定传递的参数必须是对象</span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getpa</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 响应成功之后的回调</span>
    <span class="token keyword">var</span> success <span class="token operator">=</span> option<span class="token punctuation">.</span>success<span class="token punctuation">;</span>

    <span class="token comment">// 创建异步对象</span>
    <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 让异步对象发送请求</span>
    <span class="token comment">// 请求行</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 拼接参数</span>
      url <span class="token operator">+=</span> data<span class="token punctuation">;</span>
      data <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 请求头</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/x-www-form-urlencoded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 请求体</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 让异步对象接收响应</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 一个成功的响应有两个条件：1.服务器成功响应 2.数据解析完毕可以使用</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 接收响应的返回值</span>
        <span class="token comment">// responseText   responseXML</span>
        <span class="token keyword">var</span> rh <span class="token operator">=</span> xhr<span class="token punctuation">.</span><span class="token function">getResponseHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 判断</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rh<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;xml&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> result <span class="token operator">=</span> xhr<span class="token punctuation">.</span>responseXML<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>rh<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">var</span> result <span class="token operator">=</span> xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 接收数据之后，调用回调函数</span>
        success <span class="token operator">&amp;&amp;</span> <span class="token function">success</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">post</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="jquery-中的-ajax"><a href="#jquery-中的-ajax" class="header-anchor">#</a> jQuery 中的 ajax</h3> <table><thead><tr><th>$.ajax({这里传入一个字面量对象})</th> <th>参数说明</th></tr></thead> <tbody><tr><td><strong>url</strong></td> <td>接口地址</td></tr> <tr><td><strong>type</strong></td> <td>请求方式</td></tr> <tr><td>timeout</td> <td>请求超时，单位是毫秒</td></tr> <tr><td><strong>dataType</strong></td> <td>服务器返回的格式, json / xml / jsonp</td></tr> <tr><td><strong>data</strong></td> <td>发送请求的数据</td></tr> <tr><td>beforeSend: fucntion() { …code }</td> <td>请求发起前的调用</td></tr> <tr><td><strong>success: fucntion() { …code }</strong></td> <td>成功响应后的调用</td></tr> <tr><td><strong>error: fucntion() { …code }</strong></td> <td>错误响应时的调用，e 参数为报错信息</td></tr> <tr><td>complete: fucntion() { …code }</td> <td>响应完成时的调用</td></tr> <tr><td><strong>async</strong></td> <td>true/false(默认 true,异步；false,同步)</td></tr></tbody></table> <h4 id="完整的-jquery-调用-重要"><a href="#完整的-jquery-调用-重要" class="header-anchor">#</a> 完整的 jQuery 调用(重要)</h4> <div class="language-js extra-class"><pre class="language-js"><code>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span>
  url<span class="token operator">:</span> <span class="token string">&quot;./server/nav-json.php&quot;</span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//请求需要传递的参数</span>
  <span class="token comment">// 设置请求超时:单位为毫秒，如果服务器的响应时间超过指定的时候，请求失败</span>
  timeout<span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
  dataType<span class="token operator">:</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 设置响应数据的格式  xml json text html script jsonp</span>
  <span class="token comment">// 发送请求之前的回调</span>
  <span class="token function-variable function">beforeSend</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在这个回调函数中，如果return false,那么本次请求会中止</span>
    <span class="token comment">// return false;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//请求成功之后的回调</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 请求失败之后的回调</span>
  <span class="token function-variable function">error</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>statusText <span class="token operator">==</span> <span class="token string">&quot;timeout&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;请求超时，请重试&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 无论请求是成功还是失败都会执行的回调</span>
  <span class="token function-variable function">complete</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;实现一些全局成员的释放，或者页面状态的重置....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="jquery-中-ajax-的其他用法"><a href="#jquery-中-ajax-的其他用法" class="header-anchor">#</a> jQuery 中 ajax 的其他用法</h4> <p><strong>1.1$.get()的使用</strong></p> <p>本质上只能发送 get 请求</p> <table><thead><tr><th>$.get(url, data, success, datatype)</th> <th>说明</th></tr></thead> <tbody><tr><td>url</td> <td>所请求的 url</td></tr> <tr><td>data</td> <td>请求所传递的数据</td></tr> <tr><td>success: function() { …code }</td> <td>成功之后的回调</td></tr> <tr><td>datatype:</td> <td>需要返回的数据类型</td></tr></tbody></table> <div class="language-javascript extra-class"><pre class="language-javascript"><code>$<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>
  <span class="token string">&quot;./server/nav-json.php&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 成功回调之后的函数</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">&quot;json&quot;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">123</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>1.2$.post()的使用</strong></p> <p>参数一致，用法一直，目的一致</p> <h3 id="同源-跨域"><a href="#同源-跨域" class="header-anchor">#</a> 同源&amp;跨域</h3> <p>同源策略是浏览器的一种安全策略，所谓同源是指，域名，协议，端口完全相同。</p> <p>JavaScript 出于安全方面的考虑，不允许跨域调用其他页面的对象。那什么是跨域呢，简单地理解就是因为 JavaScript 同源策略的限制，a.com 域名下的 js 无法操作 b.com 或是 c.a.com 域名下的对象。
当协议、子域名、主域名、端口号中任意一个不相同时，都算作不同域。不同域之间相互请求资源，就算作“跨域”。</p> <p><strong>注意</strong>：<strong>跨域并不是请求发不出去，请求能发出去，服务端能收到请求并正常返回结果，只是结果被浏览器拦截了</strong>。之所以会跨域，是因为受到了同源策略的限制，同源策略要求源相同才能正常进行通信，即协议、域名、端口号都完全一致</p> <p>例如http://www.example.com/</p> <table><thead><tr><th>http://api.example.com/detail.html</th> <th>不同源</th> <th>域名不同</th></tr></thead> <tbody><tr><td>https//www.example.com/detail.html</td> <td>不同源</td> <td>协议不同</td></tr> <tr><td>http://www.example.com:8080/detail.html</td> <td>不同源</td> <td>端口不同</td></tr> <tr><td>http://api.example.com:8080/detail.html</td> <td>不同源</td> <td>域名、端口不同</td></tr> <tr><td>https://api.example.com/detail.html</td> <td>不同源</td> <td>协议、域名不同</td></tr> <tr><td>https://www.example.com:8080/detail.html</td> <td>不同源</td> <td>端口、协议不同</td></tr> <tr><td>http://www.example.com/detail/index.html</td> <td>同源</td> <td>只是目录不同</td></tr></tbody></table> <table><thead><tr><th>说明</th></tr></thead> <tbody><tr><td>第一：如果是协议和端口造成的跨域问题“前端”是无能为力的</td></tr> <tr><td>第二：在跨域问题上，域仅仅是通过“URL 的首部”来识别而不会根据域名对应的 IP 地址是否相同来判断。“URL 的首部”可以理解为“协议, 域名和端口必须匹配”</td></tr></tbody></table> <p><strong>所有跨域都必须经信息提供方允许, 如果未经允许即可获取, 那是浏览器同源策略出现漏洞</strong></p> <h3 id="实现跨域"><a href="#实现跨域" class="header-anchor">#</a> 实现跨域</h3> <p><strong>1.服务器端设置 CORS 跨域(cross-origin resource sharing 跨域资源共享)</strong></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
	<span class="token comment">// 设置跨域请求</span>
	<span class="token comment">//header(&quot;Access-Control-Allow-Origin:*&quot;); // * 允许代表所有域来请求</span>
	<span class="token function">header</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;Access-Control-Allow-Origin:http://day09.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">echo</span> <span class="token function">file_get_contens</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;nav.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span>
</code></pre></div><p><strong>2.jsonp 的实现原理</strong></p> <p>页面中有几个标签允许跨域请求资源 <code>a链接的href</code> 、 <code>img的src</code> 、<code>link的href</code> 、<code>script的src</code></p> <p>1.主要是利用了 script 标签的天然的跨域特性来发送请求</p> <p>2.它的实现方式：在发送请求的时候传递一个函数名称给后台，后台返回数据的时候会返回这个函数的调用形式，并且在()中拼接参数</p> <p>3.ajax 和 jsonp 的本质不一样。ajax 的核心是通过 XMLHttpRequest 来发送请求，而 jsonp 是通过 script 标签来实现请求的发送</p> <p><strong>实现方式</strong></p> <ol><li>先定义一个函数，然后动态创建 script src 去请求资源</li> <li>在请求地址后面要加参数（参数名=函数名）</li> <li>后台拿到函数名，再以函数名调用的形式返回</li> <li>拿到数据直接调用</li></ol> <ul><li>前端开启跨域请求(dataType:“jsonp”)</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token operator">:</span><span class="token string">'get'</span><span class="token punctuation">,</span>
        <span class="token comment">// url:'getnav.php',</span>
        url<span class="token operator">:</span><span class="token string">'http://day8.com/getnav.php'</span><span class="token punctuation">,</span>
        <span class="token comment">// dataType:'json',</span>
        <span class="token comment">// 开启跨域请求</span>
        dataType<span class="token operator">:</span><span class="token string">&quot;jsonp&quot;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;有没有调用、&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span><span class="token string">&quot;navTemp&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;items&quot;</span><span class="token operator">:</span>result<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;ul&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><ul><li>后端进行拼接(拼接字符串)</li></ul> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token comment">//这就是请求时所传递过来的函数名称</span>
    <span class="token variable">$callback</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token double-quoted-string string">&quot;callback&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">//读取数据</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;nav.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//返回调用函数的形式，只不过在这个形式中要传递前台需要的数据</span>
    <span class="token keyword">echo</span> <span class="token variable">$callback</span><span class="token punctuation">.</span><span class="token single-quoted-string string">'('</span><span class="token punctuation">.</span><span class="token variable">$data</span><span class="token punctuation">.</span><span class="token single-quoted-string string">')'</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span>
</code></pre></div><h3 id="xmlhttprequest2-0"><a href="#xmlhttprequest2-0" class="header-anchor">#</a> XMLHttpRequest2.0</h3> <h4 id="timeout-延迟"><a href="#timeout-延迟" class="header-anchor">#</a> timeout(延迟)</h4> <p>timeout 代表延迟，可以当作属性设置延迟，单位为毫秒，也可以作为事件</p> <p>a) 设置超时 xhr.timeout</p> <p>b) 监听超时事件 xhr.ontimeout = function () {// code}</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span> 发送请求<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;../01-cross-origin/js/jquery.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 设置请求行</span>
            xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;01-timeout.php&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 设置请求头:get不需要设置</span>
            <span class="token comment">// 设置请求体</span>
            xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 设置超时</span>
            xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">2000</span><span class="token punctuation">;</span>
            xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 接收响应</span>
            xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// $.ajax({</span>
            <span class="token comment">//     type: &quot;get&quot;,</span>
            <span class="token comment">//     url: &quot;01-timeout.php&quot;,</span>
            <span class="token comment">//     timeout: 3000,</span>
            <span class="token comment">//     success: function(data) {</span>
            <span class="token comment">//         console.log(data);</span>
            <span class="token comment">//     },</span>
            <span class="token comment">//     error: function() {</span>
            <span class="token comment">//         console.log('超时了');</span>
            <span class="token comment">//     }</span>
            <span class="token comment">// })</span>
        <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre></div><h4 id="formdata-获取表单元素"><a href="#formdata-获取表单元素" class="header-anchor">#</a> FormData(获取表单元素)</h4> <p>form 内表单元素的 name 属性是必须的，但是不需要再一个个获取了</p> <p><strong>formdata.append(“address”,“传智播客”)</strong>;可以自由的追加参数</p> <p>a) 提供了一个新的内建对象，可用于管理表单数据</p> <p>b) 首先要获取一个表单元素 form</p> <p>c) 然后在实例化时 new FormData(form)，将表单元素 form 传进去</p> <p>d) 会返回一个对象，此对象可以直接做为 xhr.send(formData)的参数</p> <p>e) 此时我们的数据就是以二进制形式传递了(不需要设置请求头)</p> <p>f) 注意我们这里只能以 post 形式传递，浏览器会自动为我们设置一个合适的请求头</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>form id<span class="token operator">=</span><span class="token string">&quot;form1&quot;</span><span class="token operator">&gt;</span>
        用户名：<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span><span class="token operator">&gt;</span> 密码：
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;password&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;password&quot;</span><span class="token operator">&gt;</span> 电话：
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;phone&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;发送ajax请求&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;sub&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">&quot;&quot;</span> alt<span class="token operator">=</span><span class="token string">&quot;&quot;</span> width<span class="token operator">=</span><span class="token string">&quot;80&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#sub&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;02-formData.php&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 1.手动拼接</span>
            <span class="token comment">// 2.如果是jq,那么就可以使用表单序列化方法</span>
            <span class="token comment">// 3.现在在XMLHttpRequest2.0   ,我们可以使用FormData来收集表单数据</span>

            <span class="token comment">// 1.获取表单</span>
            <span class="token keyword">var</span> myform <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#form1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 2.将表单做为参数传递，在创建formData对象的时候</span>
            <span class="token keyword">var</span> formdata <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>myform<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 特点之一：可以自由的追加参数</span>
            formdata<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;address&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;传智播客&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 3.生成的formData对象就可以直接做为异步对象的参数传递</span>
            xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formdata<span class="token punctuation">)</span><span class="token punctuation">;</span>

            xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre></div><p>传统获取表单元素方法</p> <p>前端</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>form id<span class="token operator">=</span><span class="token string">&quot;form1&quot;</span><span class="token operator">&gt;</span>
        用户名：<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;username&quot;</span><span class="token operator">&gt;</span> 密码：
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;password&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;password&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;pass&quot;</span><span class="token operator">&gt;</span> 电话：
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;phone&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;phone&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;发送ajax请求&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;sub&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">&quot;&quot;</span> alt<span class="token operator">=</span><span class="token string">&quot;&quot;</span> width<span class="token operator">=</span><span class="token string">&quot;80&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#sub&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;02-formData.php&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;application/x-www-form-urlencoded&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> username <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            <span class="token keyword">var</span> password <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.pass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            <span class="token keyword">var</span> phone <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.phone&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token string">&quot;username=&quot;</span><span class="token operator">+</span>username<span class="token operator">+</span><span class="token string">&quot;&amp;&quot;</span><span class="token operator">+</span><span class="token string">&quot;password=&quot;</span><span class="token operator">+</span>password<span class="token operator">+</span><span class="token string">&quot;&amp;&quot;</span><span class="token operator">+</span><span class="token string">&quot;phone=&quot;</span><span class="token operator">+</span>phone<span class="token punctuation">;</span>
            xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre></div><h4 id="上传文件的-post-请求"><a href="#上传文件的-post-请求" class="header-anchor">#</a> 上传文件的 POST 请求</h4> <p>**注意：**这里设置了请求头的话，数据无法传递</p> <p>前端</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>form id<span class="token operator">=</span><span class="token string">&quot;form1&quot;</span><span class="token operator">&gt;</span>
        用户名：<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span><span class="token operator">&gt;</span> 密码：
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;password&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;password&quot;</span><span class="token operator">&gt;</span> 头像：
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;file&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;myfile&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;pic&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;发送ajax请求&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;sub&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;progress&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;in&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token number">0</span><span class="token operator">%</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">&quot;&quot;</span> alt<span class="token operator">=</span><span class="token string">&quot;&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;photo&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#sub&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;03-uploadFile.php&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 我想自己来设置一个请求头，看行不行--注意了，如果人为了设置了请求头，那么文件数据无法正确的传递</span>
            <span class="token comment">// xhr.setRequestHeader(&quot;Content-Type&quot;,&quot;application/x-www-form-urlencoded&quot;);</span>

            <span class="token keyword">var</span> myform <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#form1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>myform<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 监听文件上传的进度:这个监听必须在send之前来设置</span>
            xhr<span class="token punctuation">.</span>upload<span class="token punctuation">.</span><span class="token function-variable function">onprogress</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> current <span class="token operator">=</span> e<span class="token punctuation">.</span>loaded<span class="token punctuation">;</span> <span class="token comment">//上传了多少</span>
                <span class="token keyword">var</span> total <span class="token operator">=</span> e<span class="token punctuation">.</span>total<span class="token punctuation">;</span> <span class="token comment">//总共</span>
                <span class="token keyword">var</span> percent <span class="token operator">=</span> current <span class="token operator">/</span> total <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token string">&quot;%&quot;</span><span class="token punctuation">;</span>
                document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.in&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> percent<span class="token punctuation">;</span>
                document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;span&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>current <span class="token operator">/</span> total <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;%&quot;</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
            xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span><span class="token punctuation">;</span>
            xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// console.log(xhr.responseText);</span>
                    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.photo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">&quot;src&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre></div><p>后端</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
    <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'myfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token double-quoted-string string">&quot;./upload/&quot;</span><span class="token punctuation">.</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token double-quoted-string string">&quot;myfile&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token double-quoted-string string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token keyword">Array</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;src&quot;</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token double-quoted-string string">&quot;./upload/&quot;</span><span class="token punctuation">.</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token double-quoted-string string">&quot;myfile&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token double-quoted-string string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?&gt;</span></span>
</code></pre></div><h4 id="onprogress-监听文件上传的进度"><a href="#onprogress-监听文件上传的进度" class="header-anchor">#</a> onprogress 监听文件上传的进度</h4> <p><strong>注意：这段代码一定要在 send 方法之前</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 监听文件上传的进度:这个监听必须在send之前来设置</span>
xhr<span class="token punctuation">.</span>upload<span class="token punctuation">.</span><span class="token function-variable function">onprogress</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> current <span class="token operator">=</span> e<span class="token punctuation">.</span>loaded<span class="token punctuation">;</span> <span class="token comment">//上传了多少</span>
  <span class="token keyword">var</span> total <span class="token operator">=</span> e<span class="token punctuation">.</span>total<span class="token punctuation">;</span> <span class="token comment">//总共</span>
  <span class="token keyword">var</span> percent <span class="token operator">=</span> <span class="token punctuation">(</span>current <span class="token operator">/</span> total<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token string">&quot;%&quot;</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;.in&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> percent<span class="token punctuation">;</span>
  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;span&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span>
    Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>current <span class="token operator">/</span> total<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;%&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><div id="live2d-widget" class="live2d-widget-container" style="position:fixed;right:65px;bottom:0px;width:135px;height:300px;z-index:99999;opacity:0.8;pointer-events:none;"><canvas id="live2d_canvas" width="135" height="300" class="live2d_canvas" style="position:absolute;left:0px;top:0px;width:135px;height:300px;"></canvas></div></div></div>
    <script src="/assets/js/app.9189764f.js" defer></script><script src="/assets/js/2.ef243b8b.js" defer></script><script src="/assets/js/5.0210a7e9.js" defer></script>
  </body>
</html>
